#!/usr/bin/env bash

# ~/.macos â€” https://mths.be/macos
# macOS configuration script to set up system preferences and defaults

###############################################################################
# Initial Setup & System Preparation                                         #
###############################################################################

# Close any open System Preferences panes to prevent conflicts
osascript -e 'tell application "System Preferences" to quit'

# Ask for the administrator password upfront
sudo -v

# Keep-alive: update existing `sudo` time stamp until script has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

###############################################################################
# System Security & Boot Configuration                                       #
###############################################################################

# Enable open apps from unidentified developers (commented out for security)
# sudo spctl --master-disable

# Disable the sound effects on boot to avoid startup chime
sudo nvram SystemAudioVolume=" "

###############################################################################
# Keyboard & Input Configuration                                             #
###############################################################################

# Set extremely fast keyboard repeat rate (2 = fastest)
defaults write NSGlobalDomain KeyRepeat -int 2

# Set short delay before key repeat starts (15 = 225ms)
defaults write NSGlobalDomain InitialKeyRepeat -int 15

# Set mouse acceleration/scaling to high sensitivity (higher values = faster cursor movement)
defaults write -g com.apple.mouse.scaling -float 3

# Set trackpad click sensitivity to lightest touch (0 = light, 1 = medium, 2 = firm)
defaults write com.apple.AppleMultitouchTrackpad "FirstClickThreshold" -int "0"

# Enable tap to click on trackpad
defaults write com.apple.AppleMultitouchTrackpad Clicking -bool true

# Enable right-click with two-finger tap on trackpad
defaults write com.apple.AppleMultitouchTrackpad TrackpadRightClick -bool true

###############################################################################
# Dock Configuration                                                         #
###############################################################################

# Position dock on the right side of the screen for more vertical space
defaults write com.apple.dock "orientation" -string "right"

# Set dock icon size to minimum (1) for more screen real estate
defaults write com.apple.dock "tilesize" -int "1"

# Enable dock auto-hide
defaults write com.apple.dock "autohide" -bool "true"

# Set instant dock show/hide animation (0 = no delay)
defaults write com.apple.dock "autohide-time-modifier" -float "0"

# Use scale effect for minimizing windows
defaults write com.apple.dock "mineffect" -string "scale"

# Show only active applications in dock
defaults write com.apple.dock "static-only" -bool "true"

###############################################################################
# Finder Configuration                                                       #
###############################################################################

# Display hidden files in Finder by default
defaults write com.apple.finder "AppleShowAllFiles" -bool "true"

# Use list view as default view style in Finder
defaults write com.apple.finder "FXPreferredViewStyle" -string "Nlsv"

# Sort folders before files in Finder list view
defaults write com.apple.finder "_FXSortFoldersFirst" -bool "true"

# Disable warning when changing file extensions
defaults write com.apple.finder "FXEnableExtensionChangeWarning" -bool "false"

# Hide desktop icons for cleaner desktop appearance
defaults write com.apple.finder "CreateDesktop" -bool "false"

###############################################################################
# Desktop Icon Configuration                                                 #
###############################################################################

# Hide internal hard drives on desktop
defaults write com.apple.finder ShowHardDrivesOnDesktop -bool false

# Show external hard drives on desktop for easy access
defaults write com.apple.finder ShowExternalHardDrivesOnDesktop -bool true

# Show mounted servers on desktop
defaults write com.apple.finder ShowMountedServersOnDesktop -bool true

# Show removable media (USB drives, SD cards) on desktop
defaults write com.apple.finder ShowRemovableMediaOnDesktop -bool true

###############################################################################
# File Extension & Search Configuration                                      #
###############################################################################

# Always show file extensions in Finder
defaults write NSGlobalDomain AppleShowAllExtensions -bool true

# Keep folders on top when sorting by name
defaults write com.apple.finder _FXSortFoldersFirst -bool true

# When performing a search, search the current folder by default (SCcf = current folder, SCev = entire computer, SCsp = previous search scope)
defaults write com.apple.finder FXDefaultSearchScope -string "SCcf"

###############################################################################
# System File Management                                                     #
###############################################################################

# Prevent creation of .DS_Store files on network volumes
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true

# Prevent creation of .DS_Store files on USB volumes
defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true

###############################################################################
# Volume Mounting Behavior                                                   #
###############################################################################

# Automatically open Finder window when read-only disk image is mounted
defaults write com.apple.frameworks.diskimages auto-open-ro-root -bool true

# Automatically open Finder window when read-write disk image is mounted
defaults write com.apple.frameworks.diskimages auto-open-rw-root -bool true

# Automatically open Finder window when removable disk is mounted
defaults write com.apple.finder OpenWindowForNewRemovableDisk -bool true

###############################################################################
# Application-Specific Settings                                              #
###############################################################################

# Disable quit confirmation prompt in iTerm2
defaults write com.googlecode.iterm2 PromptOnQuit -bool false

###############################################################################
# Mac App Store & Software Updates                                           #
###############################################################################

# Enable automatic checking for software updates
defaults write com.apple.SoftwareUpdate AutomaticCheckEnabled -bool true

# Check for software updates daily instead of weekly (1 = daily, 7 = weekly)
defaults write com.apple.SoftwareUpdate ScheduleFrequency -int 1

# Automatically download newly available updates in background
defaults write com.apple.SoftwareUpdate AutomaticDownload -int 1

# Automatically install system data files and security updates
defaults write com.apple.SoftwareUpdate CriticalUpdateInstall -int 1

# Enable automatic App Store app updates
defaults write com.apple.commerce AutoUpdate -bool true
